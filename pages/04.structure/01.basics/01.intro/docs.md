---
title:  Basic Tutorial
taxonomy:
    category: docs
---

# NMRFx Structure

NMRFx Structure can be used to generate and analyze macromolecular structures and predict chemical shifts.  It can be run in two different ways.  First, if the command is invoked with one of several subcommands (batch, gen, predict, score, summary, super, or train) a predefined mode will be executed.  Alternatively, one can simply give as an argument a Python (actually Jython) script which will be executed.  The script has access to standard Python functions (including the standard Python library) and to specific commands provided by the NMRFx Structure program's Java code. The predifined subcommands are listed below along with documentation for usage and an example for demonstration.

    usage: nmrfxs batch|gen|predict|score|summary|super|train|script.py

## List of subcommands :

### gen

```
nmrfxs gen [ -s gen|all|refine ] [ -s seed ] [ -d directory ] [ -r report ] [ projectFile ] [ script.py ]
```

Generate a single structure using data specified in a project file and initializing the random number generator with a specified seed.  This is useful for testing out the project file before generating a whole family of structures with the batch command.  An *output* directory will be created if not present.  After successful execution, the generated PDB and violation files will be written to that directory.  The output files will have the seed number appended to them (i.e. temp0.pdb, temp0.txt, etc.). By default, the *output* directory gets placed in the current directory, however, the relative path to a different directory can be specified using the directory option. When debugging a structure generated, it may be useful to view the energy violations for all the constraints specified in the project file. To do this, specify the report option.  This will output constraint violations at prepartion stage into a file named energyDump$seed_prep.txt within the *output* directory. Lastly, define torsional angle molecular dynamic procedures in an executable script to replace the builtin annealing protocol. If a python script is specified as the last argument of the command, the script will be executed. The script can alternatively be placed inside the project file replacing the annealing data block.

__Examples__: 


    nmrfxs gen -s 0  project.yaml

    nmrfxs gen -s 0 -d ~/gen-structures  project.yaml

    nmrfxs gen -s 0  -f data.nef

    nmrfxs gen -s 0  -f data.nef project.yaml

**gen OPTIONS**:

**-h** 
:   Show help message and exit

**-s** *SEED*
:   Random number generator seed

**-d** *DIRECTORY*
:  Base directory for output files

**-v** 
:  Report violations during calculations 

**-y** *DUMPYAMLMODE*
:  Dump stages to .yaml file

**-r** *REFINEFILE*
:  Name of file to refine

**-f** *SOURCEFILE*
:  Name of file to load

**-n** *NEFoutFile*
:  Name of nef file to write.

### batch

```
nmrfxs batch [OPTIONS] projectFile
```

Generate a family of structures using the data specified in a project file.  An *output* directory and *final* directory will be created if not present.  All generated structures will be written to files (temp1.pdb, temp2.pdb, ...) in the *output* directory.  A violation file (temp1.txt, temp2.text ...) will also be written. The best structures, along with their violation files, will be written to the *final* directory. Multiple files are generated by repeatedly invoking the **nmrfxs gen** command with the specified project file and an incremented seed numbers. The number of invocations running simultaneously will be specified by the **-p** option.


**batch OPTIONS**:


-n *nStructures* 
:  The total number of structures to generate.
	
-k *keepNStructures*
:  The number of structures to keep (and write to the *final* directory).  The structures with lowest total target function will be kept.

-p *useNProcesses* 
:  Structure generation can be sped up by running multiple structure calculation processes simultaneously. This option specifies the number of simultaneous calculations to perform.

-s *startNumber* 
:  Starting number for seed. This defaults to 0, but if you want to run batch a second time and generate additional structures you can specify this value.  Also used when submitting batch commands to multiple computers for higher level of parallelization.

-a
:  If this option is specified then the structures will be automatically aligned and written to a new set of files (sup_final1.pdb, sup_final2.pdb ...).  During alignment defined regions of the structure (lower residue rms) will be identified and used for the alignmnent.

-b *baseName*
: Provide a base name for superimposed files. This option implies the structures are being aligned, or option **-a** is used.

-t *fileType*
: Provide a type for output of superimposed files.  Can be cif (for MMcif) or pdb.

-d *directory*
: Redirect output directories into a specified base directory using a relative path. By default, if this option isn't used, the output will be placed in the current directory.

-c 
: Remove output and final directores (if present)  before generating structures.  Don't do this if you are using the **-s** flag to generate additional structures.

-m *memory*
:  Allot a specific amount of heap memory to use in MegaBytes (MB). By default, 512MB of heap memory are used.

__Example__: 
`nmrfxs batch -n 100 -k 10 -p 5 -a project.yaml`


### predict

NMRFx Structure can predict chemical shifts of proteins and RNA and arbitrary small, organic molecules.
Protein predictions are done using geometric attributes (primarily dihedral angles and ring-current shifts).  RNA
predictions can be done using geometric attributes or secondary structure attribute based methods.
Attribute based methods for RNA can be done with a sequence and dot-bracket notation specified in a .yaml file or they can
be done by automatic recognition of the secondary structure from the 3D coordinates of the RNA read in from a strucutre (pdb or cif) file.
Small molecules are predicted with a HOSE code like method.

**predict OPTIONS**:

-h 
: show this help message and exit

-l *LOCATION*
: Location to store prediction in. Values less than one go into 'reference' locations. (-1)

-r *PREDMODE*
:  Prediction mode used for rna prediction. Can be **dist**, **rc** or **attr**.

-o *OUTPUTMODE*
: Output mode. Can be **star**, **protein** or **attr**. If set to **star** the output will be a portion of a BMRB chemical shift save frame. If **protein** it will be a table of backbone protein shifts. Mode **attr** is only appropriate to RNA predictions done with attributes.

Protein predictions are done for most hydrogen, carbon and nitrogen atoms.
RNA geometric predictions are done for all carbon bound protons and their carbons.
RNA attribute predictions are done for non-exchangable protons and their parent carbon and nitrogen atoms.


Prediction output in star format looks like the following.  This is an NMR-STAR3 chemical shift saveframe without the header.

         1 . 1 1   1  64 GLU N    N 15 120.210 2.470 . 1 . . . .  64 GLU N    .    . 1
         2 . 1 1   1  64 GLU CA   C 13  56.100 0.910 . 1 . . . .  64 GLU CA   .    . 1
         3 . 1 1   1  64 GLU HA   H  1   4.130 0.220 . 1 . . . .  64 GLU HA   .    . 1
         4 . 1 1   1  64 GLU CB   C 13  29.470 0.950 . 1 . . . .  64 GLU CB   .    . 1
         5 . 1 1   1  64 GLU HB2  H  1   2.000 0.190 . 1 . . . .  64 GLU HB2  .    . 1
         6 . 1 1   1  64 GLU HB3  H  1   2.070 0.200 . 1 . . . .  64 GLU HB3  .    . 1
         7 . 1 1   1  64 GLU CG   C 13  35.940 0.850 . 1 . . . .  64 GLU CG   .    . 1

Prediction output in protein format looks like the following.  This only includes "backbone* atoms, even if additional atoms have predictions:

    Num    Name      N     CA     CB      C      H  HA(2)    HA3
     64     GLU 120.21  56.10  29.47 175.45   _      4.13   _
     65     ASP 122.16  54.53  40.80 175.46   8.55   4.74   _
     66     PHE 119.86  54.86  39.16 172.19   9.03   4.76   _
     67     PRO   _     61.49  30.54 174.44   _      4.61   _
     68     PRO   _     62.14  31.80 175.47   _      4.95   _


RNA predictions based on attributes can be output in star format (as above) or the output can be a list of atom specifiers (residueNumber.atomName), predicted shifts
and various attriburtes about the prediction.

-  Atom
-  Predicted Shift 
-  N value: Value is the number of examples with the attributes this atom has.
-  Mean value: Value is the mean of the shifts of the examples.
-  +/- value: Value is the standard deviation of the shifts of the examples.
-  Range: lower upper:  The upper and lower limits of the examples.
-  A list of attributes that characterize this atoms residue (within a 5-residue window)

Output example:

    20.C2' 75.34 N  5 Mean 75.31 +/- 0.24 Range: 74.90 -75.45 Pp_AU_GC_CG_pP_-_-_-_-_-_-
    20.H2' 4.43 N  5 Mean 4.43 +/- 0.01 Range: 4.41 -4.44 Pp_AU_GC_CG_pP_-_-_-_-_-_-
    20.C1' 92.71 N  6 Mean 92.70 +/- 0.13 Range: 92.55 -92.83 Pp_AU_GC_CG_pP_-_-_-_-_-_-
    22.N4 97.53 N  6 Mean 97.57 +/- 0.42 Range: 97.22 -98.38 Pp_CG_CG_-_-_-_-_-_-_-_-
    22.H41 8.13 N 12 Mean 8.05 +/- 0.68 Range: 6.84 -8.67 Pp_CG_CG_-_-_-_-_-_-_-_-
    22.H42 7.30 N 11 Mean 7.41 +/- 0.64 Range: 6.95 -8.50 Pp_CG_CG_-_-_-_-_-_-_-_-
    22.C5 98.24 N 18 Mean 98.24 +/- 0.29 Range: 97.86 -99.20 Pp_CG_CG_-_-_-_-_-_-_-_-
    22.H5 5.46 N 34 Mean 5.46 +/- 0.10 Range: 5.23 -5.77 Pp_CG_CG_-_-_-_-_-_-_-_-
    22.C6 141.97 N 17 Mean 142.02 +/- 1.10 Range: 141.27 -146.07 Pp_CG_CG_-_-_-_-_-_-_-_-

The output for small molecules is a simple table of atom name and chemical shift:

    C6 136.60
    C7 129.30
    C8 157.70
    C9 168.20
    C10 45.40


__Examples__:

* `nmrfxs predict protein.pdb`

* `nmrfxs predict project.yaml`

### score

```
nmrfxs score [OPTIONS] projectFile [pdbFile1.pdb, pdbFile2.pdb, ...]
```

Analyze the quality of the structure(s) generated by using the score subcommand. Note: the *summary* command listed above 
analyzes the output files from a previous run of *nmrfx batch*.  This command will load pdb files and analyze them 
according to the constraints referenced in the .yaml and on the command line (see options below).

**score OPTIONS**:

**-y** *projectFile* 
:  The project file that defines constraints to be used in the analysis.

**-o** *outDir* 
:  The directory in which to write output files.  Defaults to *analysis*.

**-p** *pdbFilePattern* 
:  PDB files can be specified as an argument to this command.  This argument will result in execution of a Python level glob command to search for files that match the specified pattern. If wild card characters (*) are specified, then the whole pattern needs to be included in single quotes.

**-d** *directory*
: Specify a directory to redirect output directories generated.

**-s** *shifts*
: Add chemical shift files that are not specified in the YAML project file.

**-d** *distances*
: Add distance constraints files that are not specified in the YAML project file.

__Examples__:

* `nmrfxs score -y project.yaml pdb/\*.pdb`

* `nmrfxs score -y project.yaml -p 'pdb/\*.pdb'`


### summary

```
nmrfxs summary [final/final1.txt, final/final2.txt, ...]
```

**summary OPTIONS**:

-h
:   show this help message and exit


-l *LIMDIS*
:   Only violations with an error of at least this amount will be reported (0.2)

-n *NVIOLS*
:   Only violations that occur in at least this number of structures will be reported (2).


Analyze output files and create a summary file showing what constraints are violated.  If no output files are specified as arguments,
all final*.txt files in the final subdirectory of the current directory will be analyzed.  **Summary** is different than the **score** subcommand
in that the violation information is harvested from the output files from the structure calculation, whereas  the **score** command
loads in pdb files and analyzes them.

The output will be placed in a file named analysis.txt and wil have a format like this:

    Type            Atom1              Atom2 nViol      Bound       Mean        Max Structures
     Dis:        1:141.H3' -         1:141.H8    3       3.00       0.45       0.61 |+++.|
     Dis:         1:141.H2 -        1:142.H1'    3       5.00       0.49       0.69 |+++.|
     Dis:         1:130.H2 -         1:134.H8    3       5.00       0.25       0.39 |++.+|



### super

Calculate the superpostion of a set of models.  Multiple cycles (specified with -n flag) of superpostion are done to identify
regions that are considered core.  Core residues are identified as those residues whose rms value is less than twice the median of the rms for all residues.  Superimmposed structures can be output into multiple pdb files 
or a single  MMcif file.

**super OPTIONS**:

-h
:    show this help message and exit

-r *RESLISTE*
:   Residues to exclude from comparison. Can specify residue ranges and individual values (e.g. 2-5 or 10).


-a *ATOMLISTE*
:  Atoms to exclude from comparison.

-R *RESLISTI*
:  Residues to include in comparison

-A *ATOMLISTI*
:  Atoms to include in comparison

-c
:  Whether to compare calculated structures to reference structure, and save output to a file.

-t *TYPE*
:  Type (cif|pdb) for saved aligned models. No files saved if this argument is not specified. (None)

-b *BASENAME*
:  Base name (prefix) for superimposed file names.

-n *NCORE*
:  Number of core residue cycles. Default is 5.

### train
*Information pending...*


### script.py

